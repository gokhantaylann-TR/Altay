<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Altayâ€™Ä±n MacerasÄ± â€“ Stabil SÃ¼rÃ¼m</title>

<script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>

<style>
html, body {
  margin: 0;
  padding: 0;
  background: #87ceeb;
  overflow: hidden;
}
button {
  position: fixed;
  bottom: 20px;
  width: 70px;
  height: 70px;
  font-size: 24px;
  border-radius: 50%;
  border: none;
  background: rgba(0,0,0,0.5);
  color: #fff;
}
#left { left: 20px; }
#right { left: 110px; }
#jump { right: 20px; }
</style>
</head>

<body>

<button id="left">â—€</button>
<button id="right">â–¶</button>
<button id="jump">â–²</button>

<script>
const config = {
  type: Phaser.AUTO,
  width: 800,
  height: 600,
  physics: {
    default: 'arcade',
    arcade: {
      gravity: { y: 900 },
      debug: false
    }
  },
  scene: { preload, create, update }
};

let player, cursors;
let moveLeft=false, moveRight=false, jump=false;
let enemies, diamonds;

const game = new Phaser.Game(config);

function preload () {
  this.load.image('ground', 'https://labs.phaser.io/assets/sprites/platform.png');
  this.load.spritesheet('altay', 'https://labs.phaser.io/assets/sprites/dude.png', {
    frameWidth: 32,
    frameHeight: 48
  });
  this.load.image('duck', 'https://labs.phaser.io/assets/sprites/duck.png');
  this.load.image('diamond', 'https://labs.phaser.io/assets/sprites/diamond.png');
  this.load.image('castle', 'https://labs.phaser.io/assets/sprites/castle.png');
}

function create () {
  // WORLD
  this.physics.world.setBounds(0, 0, 2000, 600);

  // GROUND
  const platforms = this.physics.add.staticGroup();
  for (let i=0;i<10;i++) {
    platforms.create(200*i, 580, 'ground').setScale(2).refreshBody();
  }

  platforms.create(600, 420, 'ground');
  platforms.create(900, 320, 'ground');

  // PLAYER
  player = this.physics.add.sprite(100, 450, 'altay');
  player.setCollideWorldBounds(true);

  this.anims.create({
    key: 'left',
    frames: this.anims.generateFrameNumbers('altay', { start: 0, end: 3 }),
    frameRate: 10,
    repeat: -1
  });

  this.anims.create({
    key: 'right',
    frames: this.anims.generateFrameNumbers('altay', { start: 5, end: 8 }),
    frameRate: 10,
    repeat: -1
  });

  this.anims.create({
    key: 'idle',
    frames: [{ key: 'altay', frame: 4 }],
    frameRate: 20
  });

  // DIAMONDS
  diamonds = this.physics.add.group();
  diamonds.create(600, 370, 'diamond').setScale(0.5);
  diamonds.create(900, 270, 'diamond').setScale(0.5);

  // ENEMY (DUCK)
  enemies = this.physics.add.group();
  const duck = enemies.create(700, 520, 'duck');
  duck.setScale(0.8);
  duck.setVelocityX(80);
  duck.direction = 1;

  // CASTLE
  const castle = this.physics.add.staticImage(1850, 450, 'castle').setScale(2.5);

  // COLLIDERS
  this.physics.add.collider(player, platforms);
  this.physics.add.collider(enemies, platforms);
  this.physics.add.collider(diamonds, platforms);

  this.physics.add.overlap(player, diamonds, (p,d)=>d.destroy());
  this.physics.add.overlap(player, enemies, hitEnemy, null, this);
  this.physics.add.overlap(player, castle, ()=>alert('ðŸ° BÃ¶lÃ¼m Tamam!'));

  // CAMERA
  this.cameras.main.setBounds(0,0,2000,600);
  this.cameras.main.startFollow(player, true, 0.08, 0.08);

  cursors = this.input.keyboard.createCursorKeys();

  // MOBILE BUTTONS
  document.getElementById('left').ontouchstart = ()=> moveLeft=true;
  document.getElementById('left').ontouchend = ()=> moveLeft=false;
  document.getElementById('right').ontouchstart = ()=> moveRight=true;
  document.getElementById('right').ontouchend = ()=> moveRight=false;
  document.getElementById('jump').ontouchstart = ()=> jump=true;
}

function update () {
  if (cursors.left.isDown || moveLeft) {
    player.setVelocityX(-200);
    player.anims.play('left', true);
  } else if (cursors.right.isDown || moveRight) {
    player.setVelocityX(200);
    player.anims.play('right', true);
  } else {
    player.setVelocityX(0);
    player.anims.play('idle');
  }

  if ((cursors.up.isDown || jump) && player.body.touching.down) {
    player.setVelocityY(-450);
    jump = false;
  }

  // ENEMY AI
  enemies.children.iterate(e=>{
    if (!e) return;
    if (e.x < 650) { e.setVelocityX(80); e.flipX=false; }
    if (e.x > 900) { e.setVelocityX(-80); e.flipX=true; }
  });
}

function hitEnemy (player, enemy) {
  if (player.body.velocity.y > 0) {
    enemy.destroy();
    player.setVelocityY(-300);
  } else {
    this.scene.restart();
  }
}
</script>
</body>
</html>