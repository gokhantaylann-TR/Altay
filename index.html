<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<title>Altay'ƒ±n Macerasƒ±</title>
<script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>

<style>
body { margin:0; background:#000; overflow:hidden; }
canvas { display:block; margin:auto; }

.btn {
 position:fixed;
 bottom:20px;
 width:60px;
 height:60px;
 border-radius:50%;
 background:#ffffff44;
 color:#fff;
 font-size:28px;
 display:flex;
 align-items:center;
 justify-content:center;
 user-select:none;
}

#left { left:20px; }
#right { left:100px; }
#jump { right:100px; }
#fire { right:20px; }
</style>
</head>
<body>

<div id="left" class="btn">‚óÄ</div>
<div id="right" class="btn">‚ñ∂</div>
<div id="jump" class="btn">‚§í</div>
<div id="fire" class="btn">üî•</div>

<script>
const WIDTH=800, HEIGHT=600, WORLD_WIDTH=4000;
let soundEnabled=true;
let mobileInput={left:false,right:false,jump:false,fire:false};

/* ================= MOBILE CONTROLS ================= */
function bindBtn(id,key){
 const el=document.getElementById(id);
 el.addEventListener("touchstart",()=>mobileInput[key]=true);
 el.addEventListener("touchend",()=>mobileInput[key]=false);
}
bindBtn("left","left");
bindBtn("right","right");
bindBtn("jump","jump");
bindBtn("fire","fire");

/* ================= MENU ================= */
class MenuScene extends Phaser.Scene{
 constructor(){super("Menu");}
 preload(){
  this.load.image("bg","https://labs.phaser.io/assets/skies/space3.png");
 }
 create(){
  this.add.image(400,300,"bg");
  this.add.text(400,180,"ALTAY'IN MACERASI",{fontSize:42,color:"#fff"}).setOrigin(0.5);

  const start=this.add.text(400,300,"‚ñ∂ BA≈ûLA",{fontSize:32,backgroundColor:"#000",padding:10}).setOrigin(0.5).setInteractive();
  start.on("pointerdown",()=>this.scene.start("Level1"));
 }
}

/* ================= LEVEL ================= */
class Level1 extends Phaser.Scene{
 constructor(){super("Level1");}

 preload(){
  this.load.image("sky","https://labs.phaser.io/assets/skies/sky4.png");
  this.load.image("ground","https://labs.phaser.io/assets/sprites/platform.png");
  this.load.image("enemy","https://labs.phaser.io/assets/sprites/phaser-dude.png");
  this.load.image("bullet","https://labs.phaser.io/assets/sprites/bullets/bullet1.png");
  this.load.spritesheet("altay","https://labs.phaser.io/assets/sprites/dude.png",{frameWidth:32,frameHeight:48});
  this.load.audio("hit","https://labs.phaser.io/assets/audio/SoundEffects/explosion.mp3");
 }

 create(){
  this.lives=3;
  this.physics.world.setBounds(0,0,WORLD_WIDTH,HEIGHT);
  this.add.tileSprite(0,0,WORLD_WIDTH,HEIGHT,"sky").setOrigin(0);

  this.platforms=this.physics.add.staticGroup();
  for(let i=0;i<12;i++){
   this.platforms.create(i*350+200,560,"ground").setScale(2).refreshBody();
  }

  this.player=this.physics.add.sprite(100,450,"altay").setCollideWorldBounds(true);

  this.anims.create({
   key:"run",frames:this.anims.generateFrameNumbers("altay",{start:5,end:8}),frameRate:10,repeat:-1
  });
  this.anims.create({key:"idle",frames:[{key:"altay",frame:4}],frameRate:10});

  this.enemies=this.physics.add.group();
  for(let i=1;i<6;i++) this.spawnEnemy(i*600);

  this.bullets=this.physics.add.group();

  this.physics.add.collider(this.player,this.platforms);
  this.physics.add.collider(this.enemies,this.platforms);
  this.physics.add.overlap(this.player,this.enemies,this.hitPlayer,null,this);
  this.physics.add.overlap(this.bullets,this.enemies,this.hitEnemy,null,this);

  this.cursors=this.input.keyboard.createCursorKeys();
  this.space=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);

  this.camera=this.cameras.main;
  this.camera.setBounds(0,0,WORLD_WIDTH,HEIGHT);
  this.camera.startFollow(this.player);

  this.hitSfx=this.sound.add("hit");

  this.ui();
 }

 ui(){
  this.livesText=this.add.text(20,20,"‚ù§Ô∏è "+this.lives,{fontSize:24}).setScrollFactor(0);
  this.add.text(400,20,"Y√∂n: Oklar | Zƒ±pla: ‚Üë | Ate≈ü: Space",{fontSize:14,color:"#fff"}).setOrigin(0.5).setScrollFactor(0);

  const soundBtn=this.add.text(750,20,"üîä",{fontSize:28}).setScrollFactor(0).setInteractive();
  soundBtn.on("pointerdown",()=>{
   soundEnabled=!soundEnabled;
   this.sound.mute=!soundEnabled;
   soundBtn.setText(soundEnabled?"üîä":"üîá");
  });
 }

 spawnEnemy(x){
  const e=this.physics.add.sprite(x,450,"enemy");
  e.setCollideWorldBounds(true);
  this.enemies.add(e);
 }

 shoot(){
  const dir=this.player.flipX?-1:1;
  const b=this.bullets.create(this.player.x+dir*20,this.player.y,"bullet");
  b.setVelocityX(dir*600);
  b.body.allowGravity=false;
  this.time.delayedCall(1200,()=>b.destroy());
 }

 hitEnemy(b,e){
  b.destroy(); e.destroy();
  if(soundEnabled) this.hitSfx.play();
 }

 hitPlayer(){
  this.lives--;
  this.livesText.setText("‚ù§Ô∏è "+this.lives);
  if(soundEnabled) this.hitSfx.play();

  if(this.lives<=0){
   this.scene.start("Menu");
  }else{
   this.player.setPosition(100,400);
  }
 }

 update(){
  const left=this.cursors.left.isDown||mobileInput.left;
  const right=this.cursors.right.isDown||mobileInput.right;
  const jump=(this.cursors.up.isDown||mobileInput.jump)&&this.player.body.blocked.down;
  const fire=Phaser.Input.Keyboard.JustDown(this.space)||mobileInput.fire;

  if(left){
   this.player.setVelocityX(-220);
   this.player.flipX=true;
   this.player.anims.play("run",true);
  }else if(right){
   this.player.setVelocityX(220);
   this.player.flipX=false;
   this.player.anims.play("run",true);
  }else{
   this.player.setVelocityX(0);
   this.player.anims.play("idle",true);
  }

  if(jump) this.player.setVelocityY(-720);
  if(fire) this.shoot();

  this.enemies.children.iterate(e=>{
   if(e) e.setVelocityX(Math.sin(this.time.now*0.002+e.x)*80);
  });
 }
}

/* ================= GAME ================= */
new Phaser.Game({
 type:Phaser.AUTO,
 width:WIDTH,
 height:HEIGHT,
 physics:{default:"arcade",arcade:{gravity:{y:1400},debug:false}},
 scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},
 scene:[MenuScene,Level1]
});

/* ================= OFFLINE ================= */
if("serviceWorker" in navigator){
 navigator.serviceWorker.register("sw.js");
}
</script>
</body>
</html>
