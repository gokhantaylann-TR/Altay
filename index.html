<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Altay'Ä±n MacerasÄ±</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000">

<script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>

<style>
body { margin:0; background:#000; overflow:hidden; touch-action:none; }
canvas { display:block; }
#ui {
  position: fixed; top: 10px; right: 10px; z-index: 9999;
}
#ui button {
  font-size: 16px;
  padding: 8px 12px;
}
</style>
</head>
<body>

<div id="ui">
  <button id="soundBtn">ðŸ”Š</button>
</div>

<script>
/* ------------------ PWA ------------------ */
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js');
}

/* ------------------ SES ------------------ */
let soundOn = localStorage.getItem("sound") !== "off";
document.getElementById("soundBtn").innerText = soundOn ? "ðŸ”Š" : "ðŸ”‡";
document.getElementById("soundBtn").onclick = () => {
  soundOn = !soundOn;
  localStorage.setItem("sound", soundOn ? "on" : "off");
  document.getElementById("soundBtn").innerText = soundOn ? "ðŸ”Š" : "ðŸ”‡";
};

/* ------------------ OYUN ------------------ */
const config = {
  type: Phaser.AUTO,
  width: 800,
  height: 600,
  scale: { mode: Phaser.Scale.FIT, autoCenter: Phaser.Scale.CENTER_BOTH },
  physics: { default: 'arcade', arcade: { gravity: { y: 1400 }, debug: false } },
  scene: { preload, create, update }
};

let player, platforms, bricks, diamonds, enemies, castle;
let left=false, right=false, jump=false;
const worldWidth = 4800;

new Phaser.Game(config);

function preload() {
  this.load.image('sky','https://labs.phaser.io/assets/skies/sky4.png');
  this.load.image('ground','https://labs.phaser.io/assets/sprites/platform.png');
  this.load.image('brick','https://labs.phaser.io/assets/sprites/block.png');
  this.load.spritesheet('altay','https://labs.phaser.io/assets/sprites/dude.png',{frameWidth:32,frameHeight:48});
}

function create() {
  this.physics.world.setBounds(0,0,worldWidth,600);
  this.add.tileSprite(0,0,worldWidth,600,'sky').setOrigin(0);

  createCloud(this);
  this.add.tileSprite(0,100,worldWidth,200,'cloud').setScrollFactor(0.4).setAlpha(0.7);

  platforms = this.physics.add.staticGroup();
  for(let i=0;i<worldWidth/400;i++){
    platforms.create(400*i+200,568,'ground').setScale(2).refreshBody();
  }

  bricks = this.physics.add.staticGroup();
  const brickPos = [
    {x:600,y:350},{x:640,y:350},{x:680,y:350},
    {x:1500,y:300},{x:1540,y:300},{x:1580,y:300}
  ];
  brickPos.forEach(b=>bricks.create(b.x,b.y,'brick').refreshBody());

  diamonds = this.physics.add.staticGroup();
  brickPos.forEach(b=>{
    let d = diamonds.create(b.x,b.y-40);
    d.setTexture(createDiamond(this));
    d.setScale(0.45);
    d.refreshBody();
  });

  player = this.physics.add.sprite(loadX(),450,'altay');
  player.setCollideWorldBounds(true);

  this.anims.create({key:'left',frames:this.anims.generateFrameNumbers('altay',{start:0,end:3}),frameRate:10,repeat:-1});
  this.anims.create({key:'right',frames:this.anims.generateFrameNumbers('altay',{start:5,end:8}),frameRate:10,repeat:-1});
  this.anims.create({key:'idle',frames:[{key:'altay',frame:4}]});

  enemies = this.physics.add.group();
  spawnDuck(this,700);
  spawnDuck(this,1600);
  spawnDuck(this,2800);

  castle = this.physics.add.staticSprite(4600,480,createCastle(this)).refreshBody();

  this.cameras.main.setBounds(0,0,worldWidth,600);
  this.cameras.main.startFollow(player,true,0.08,0.08);

  this.physics.add.collider(player,platforms);
  this.physics.add.collider(player,bricks);
  this.physics.add.collider(enemies,platforms);

  this.physics.add.overlap(player,diamonds,(p,d)=>d.destroy());
  this.physics.add.overlap(player,enemies,hitEnemy,null,this);
  this.physics.add.overlap(player,castle,finish,null,this);

  this.input.on('pointerdown',p=>{
    if(p.x<200) left=true;
    else if(p.x>600) right=true;
    else jump=true;
  });
  this.input.on('pointerup',()=>{left=false; right=false;});
}

function update() {
  if(left){ player.setVelocityX(-220); player.anims.play('left',true); player.flipX=true; }
  else if(right){ player.setVelocityX(220); player.anims.play('right',true); player.flipX=false; }
  else { player.setVelocityX(0); player.anims.play('idle'); }

  if(jump && player.body.touching.down){ player.setVelocityY(-650); jump=false; }

  enemies.children.iterate(e=>{
    if(!e) return;
    if(e.body.blocked.left) e.dir=1;
    if(e.body.blocked.right) e.dir=-1;
    e.setVelocityX(80*(e.dir||-1));
  });

  saveX(player.x);
}

/* --------- OYUN AKIÅž --------- */
function hitEnemy(p,e){
  if(p.body.touching.down){ e.destroy(); p.setVelocityY(-300); }
  else { localStorage.removeItem("x"); location.reload(); }
}

function finish(){
  localStorage.removeItem("x");
  alert("ðŸŽ‰ BÃ–LÃœM TAMAMLANDI");
}

/* --------- SAVE --------- */
function saveX(x){ localStorage.setItem("x",Math.floor(x)); }
function loadX(){ return parseInt(localStorage.getItem("x")||100); }

/* --------- GRAFÄ°KLER --------- */
function spawnDuck(scene,x){
  let e = scene.physics.add.sprite(x,520,createDuck(scene));
  e.body.setSize(20,20);
  e.dir=-1;
  enemies.add(e);
}
function createDuck(scene){
  if(scene.textures.exists('duck')) return 'duck';
  const g=scene.make.graphics({add:false});
  g.fillStyle(0xffcc00).fillRect(4,8,20,12);
  g.fillStyle(0xff8800).fillRect(20,12,6,4);
  g.generateTexture('duck',28,28);
  return 'duck';
}
function createDiamond(scene){
  if(scene.textures.exists('diamond')) return 'diamond';
  const g=scene.make.graphics({add:false});
  g.fillStyle(0x00ffff);
  g.beginPath(); g.moveTo(16,0); g.lineTo(32,16); g.lineTo(16,32); g.lineTo(0,16); g.closePath(); g.fillPath();
  g.generateTexture('diamond',32,32);
  return 'diamond';
}
function createCastle(scene){
  if(scene.textures.exists('castle')) return 'castle';
  const g=scene.make.graphics({add:false});
  g.fillStyle(0x888888).fillRect(0,16,64,48);
  g.fillRect(8,0,16,16); g.fillRect(40,0,16,16);
  g.fillStyle(0x444444).fillRect(28,40,8,24);
  g.generateTexture('castle',64,64);
  return 'castle';
}
function createCloud(scene){
  if(scene.textures.exists('cloud')) return;
  const g=scene.make.graphics({add:false});
  g.fillStyle(0xffffff);
  g.fillCircle(40,40,20); g.fillCircle(60,30,25); g.fillCircle(80,40,20);
  g.generateTexture('cloud',120,80);
}
</script>
</body>
</html>