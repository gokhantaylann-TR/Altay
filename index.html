<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Altayâ€™Ä±n MacerasÄ± - DÃ¼zeltilmiÅŸ Versiyon</title>

<script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>

<style>
html, body {
  margin: 0;
  padding: 0;
  background: #87ceeb;
  overflow: hidden;
  touch-action: none; /* Mobilde Ã§ift dokunma zoom'unu engeller */
}

.ui {
  position: fixed;
  bottom: 20px;
  left: 0;
  right: 0;
  display: flex;
  justify-content: space-between;
  padding: 0 20px;
  pointer-events: none;
  z-index: 100;
}

/* Buton stilleri */
.ui button {
  pointer-events: auto;
  width: 70px;
  height: 70px;
  border-radius: 50%;
  border: 2px solid #fff;
  font-size: 30px;
  background: rgba(0,0,0,0.5);
  color: #fff;
  outline: none;
  user-select: none; /* Metin seÃ§imini engeller */
  -webkit-user-select: none;
}

.ui button:active {
  background: rgba(0,0,0,0.8);
}
</style>
</head>

<body>

<div class="ui">
  <div style="pointer-events: auto;">
    <button id="btnLeft">â—€</button>
    <button id="btnRight">â–¶</button>
  </div>
  <button id="btnJump">â–²</button>
</div>

<script>
const config = {
  type: Phaser.AUTO,
  width: 800,
  height: 600,
  scale: {
    mode: Phaser.Scale.FIT,
    autoCenter: Phaser.Scale.CENTER_BOTH
  },
  physics: {
    default: 'arcade',
    arcade: { 
        gravity: { y: 600 }, // Yer Ã§ekimini biraz azalttÄ±m, daha kontrollÃ¼ olsun
        debug: false 
    }
  },
  scene: { preload, create, update }
};

let player, cursors;
// DeÄŸiÅŸken isimlerini buton ID'lerinden farklÄ± yaptÄ±m
let isMovingLeft = false;
let isMovingRight = false;
let isJumping = false;

let enemies;
let gameOver = false;

new Phaser.Game(config);

function preload() {
  this.load.image('ground', 'https://labs.phaser.io/assets/sprites/platform.png');
  this.load.spritesheet('altay', 'https://labs.phaser.io/assets/sprites/dude.png', { frameWidth: 32, frameHeight: 48 });
  // Ã–rdek yerine standart bir dÃ¼ÅŸman gÃ¶rseli (Phaser topu) veya varsa Ã¶rdek
  this.load.image('enemy', 'https://labs.phaser.io/assets/sprites/phaser-dude.png'); 
  // Castle yerine 'star' kullanÄ±yorum, daha garantidir.
  this.load.image('goal', 'https://labs.phaser.io/assets/sprites/star.png');
}

function create() {
  gameOver = false;
  
  // DÃ¼nya sÄ±nÄ±rlarÄ±
  this.physics.world.setBounds(0, 0, 1400, 600);

  // Arkaplan
  this.add.rectangle(0, 0, 1400, 600, 0x87ceeb).setOrigin(0,0);

  const platforms = this.physics.add.staticGroup();

  // ZEMÄ°N OLUÅTURMA
  for(let i=0; i<8; i++){
    platforms.create(200 * i, 580, 'ground').setScale(2).refreshBody();
  }

  // PLATFORMLAR
  platforms.create(300, 420, 'ground');
  platforms.create(450, 350, 'ground');
  platforms.create(750, 280, 'ground').setScale(1.5, 1).refreshBody(); // Uzun platform
  platforms.create(1100, 220, 'ground');
  platforms.create(1250, 350, 'ground');

  // OYUNCU (ALTAY)
  player = this.physics.add.sprite(100, 450, 'altay');
  player.setBounce(0.1);
  player.setCollideWorldBounds(true);

  // ANÄ°MASYONLAR
  if(!this.anims.exists('left')) {
      this.anims.create({
        key: 'left',
        frames: this.anims.generateFrameNumbers('altay', { start: 0, end: 3 }),
        frameRate: 10,
        repeat: -1
      });
  }
  
  if(!this.anims.exists('right')) {
      this.anims.create({
        key: 'right',
        frames: this.anims.generateFrameNumbers('altay', { start: 5, end: 8 }),
        frameRate: 10,
        repeat: -1
      });
  }

  if(!this.anims.exists('idle')) {
      this.anims.create({
        key: 'idle',
        frames: [ { key: 'altay', frame: 4 } ],
        frameRate: 20
      });
  }

  // DÃœÅMANLAR
  enemies = this.physics.add.group();
  
  // 1. DÃ¼ÅŸman
  createEnemy(enemies, 750, 240, 680, 820);
  // 2. DÃ¼ÅŸman
  createEnemy(enemies, 400, 310, 380, 520);

  // BÄ°TÄ°Å NOKTASI (KALE/YILDIZ)
  const goal = this.physics.add.staticImage(1350, 520, 'goal').setScale(2);

  // Ã‡ARPIÅMALAR
  this.physics.add.collider(player, platforms);
  this.physics.add.collider(enemies, platforms);

  this.physics.add.overlap(player, enemies, hitEnemy, null, this);
  this.physics.add.overlap(player, goal, winGame, null, this);

  // KAMERA
  this.cameras.main.setBounds(0, 0, 1400, 600);
  this.cameras.main.startFollow(player, true, 0.08, 0.08);

  // KLAVYE KONTROLLERÄ°
  cursors = this.input.keyboard.createCursorKeys();

  // --- MOBÄ°L / BUTON KONTROLLERÄ° (DÃœZELTÄ°LEN KISIM) ---
  setupMobileControls();
}

function createEnemy(group, x, y, minX, maxX) {
    const enemy = group.create(x, y, 'enemy');
    enemy.setTint(0xff0000); // DÃ¼ÅŸman olduÄŸu belli olsun diye kÄ±rmÄ±zÄ± yaptÄ±m
    enemy.setScale(0.8);
    enemy.setVelocityX(100);
    enemy.minX = minX;
    enemy.maxX = maxX;
    enemy.setBounce(1);
    enemy.setCollideWorldBounds(true);
}

function setupMobileControls() {
    // ID ile elemanlarÄ± gÃ¼venli ÅŸekilde seÃ§iyoruz
    const btnLeft = document.getElementById('btnLeft');
    const btnRight = document.getElementById('btnRight');
    const btnJump = document.getElementById('btnJump');

    // Helper fonksiyon: Olay dinleyicilerini ekle (Hem Mouse hem Touch iÃ§in)
    const addEvents = (btn, startAction, endAction) => {
        // Dokunmatik
        btn.addEventListener('touchstart', (e) => { e.preventDefault(); startAction(); }, {passive: false});
        btn.addEventListener('touchend', (e) => { e.preventDefault(); endAction(); });
        // Mouse (Bilgisayar testi iÃ§in)
        btn.addEventListener('mousedown', (e) => { startAction(); });
        btn.addEventListener('mouseup', (e) => { endAction(); });
        btn.addEventListener('mouseleave', (e) => { endAction(); });
    };

    addEvents(btnLeft, () => isMovingLeft = true, () => isMovingLeft = false);
    addEvents(btnRight, () => isMovingRight = true, () => isMovingRight = false);
    addEvents(btnJump, () => isJumping = true, () => isJumping = false);
}

function update() {
  if (gameOver) return;

  // Hareket MantÄ±ÄŸÄ± (Klavye VEYA Butonlar)
  if (cursors.left.isDown || isMovingLeft) {
    player.setVelocityX(-200);
    player.anims.play('left', true);
  } else if (cursors.right.isDown || isMovingRight) {
    player.setVelocityX(200);
    player.anims.play('right', true);
  } else {
    player.setVelocityX(0);
    player.anims.play('idle');
  }

  // ZÄ±plama MantÄ±ÄŸÄ±
  // player.body.touching.down: Oyuncu yere basÄ±yor mu?
  if ((cursors.up.isDown || isJumping) && player.body.touching.down) {
    player.setVelocityY(-450);
    isJumping = false; // SÃ¼rekli zÄ±plamayÄ± Ã¶nlemek iÃ§in (isteÄŸe baÄŸlÄ±)
  }

  // DÃ¼ÅŸman Yapay ZekasÄ±
  enemies.children.iterate((enemy) => {
    if (!enemy) return;
    
    if (enemy.x <= enemy.minX) {
        enemy.setVelocityX(100);
        enemy.flipX = false; // YÃ¼zÃ¼nÃ¼ Ã§evir
    } else if (enemy.x >= enemy.maxX) {
        enemy.setVelocityX(-100);
        enemy.flipX = true;
    }
  });
}

function hitEnemy(player, enemy) {
  // EÄŸer oyuncu dÃ¼ÅŸmanÄ±n tepesindeyse (Yere basmÄ±yor ve dÃ¼ÅŸmanÄ±n Ã¼stÃ¼nde)
  if (player.body.velocity.y > 0 && player.y < enemy.y) {
    enemy.destroy();
    player.setVelocityY(-300); // KÃ¼Ã§Ã¼k bir zÄ±plama efekti
  } else {
    // Oyuncu Ã¶ldÃ¼
    this.physics.pause();
    player.setTint(0xff0000);
    player.anims.play('idle');
    gameOver = true;
    
    // 1 saniye sonra yeniden baÅŸlat
    setTimeout(() => {
        this.scene.restart();
    }, 1000);
  }
}

function winGame(player, goal) {
    this.physics.pause();
    player.setTint(0x00ff00);
    alert('Tebrikler! BÃ¶lÃ¼mÃ¼ KazandÄ±n! ğŸ†');
    this.scene.restart();
}
</script>
</body>
</html>
